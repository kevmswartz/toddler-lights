<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Govee Lights</title>
    <link rel="stylesheet" href="tailwind.css">
    <style>
        body {
            -webkit-tap-highlight-color: transparent;
        }
    </style>
</head>
<body class="min-h-screen bg-slate-950 text-slate-100">
    <div class="mx-auto max-w-5xl px-4 py-10 space-y-8 md:px-8">
        <header class="space-y-3">
            <h1 class="text-3xl font-bold text-white md:text-4xl">Govee Lights Controller</h1>
            <p class="text-slate-200">Send LAN UDP commands from the Tauri shell or fall back to the Govee Cloud API.</p>
            <div class="flex flex-wrap items-center gap-3 text-sm">
                <span id="runtimeBadge" class="inline-flex items-center gap-2 rounded-full bg-white/10 px-3 py-1 font-semibold text-white">
                    Runtime: detecting…
                </span>
                <span id="runtimeNote" class="text-slate-300">Waiting for app startup.</span>
            </div>
        </header>

        <section class="space-y-4 rounded-3xl bg-white/5 p-6 shadow-2xl backdrop-blur-md md:p-8">
            <div class="flex flex-col gap-2 md:flex-row md:items-center md:justify-between">
                <div>
                    <h2 class="text-xl font-bold text-white">LAN Light</h2>
                    <p class="text-sm text-slate-300">Use UDP port 4003 on your Wi‑Fi network. Commands run locally inside the Tauri app.</p>
                </div>
                <div id="lanStatus" class="text-sm text-amber-100"></div>
            </div>

            <div class="grid gap-4 md:grid-cols-3">
                <div class="space-y-3">
                    <label class="text-xs font-semibold uppercase tracking-wide text-indigo-200">Light IP</label>
                    <input id="lanIp" type="text" class="w-full rounded-2xl border border-white/20 bg-white/10 px-4 py-3 text-white placeholder:text-slate-400 focus:border-white/50 focus:outline-none focus:ring-2 focus:ring-white/50" placeholder="192.168.x.x">
                    <label class="text-xs font-semibold uppercase tracking-wide text-indigo-200">Port</label>
                    <input id="lanPort" type="number" class="w-full rounded-2xl border border-white/20 bg-white/10 px-4 py-3 text-white placeholder:text-slate-400 focus:border-white/50 focus:outline-none focus:ring-2 focus:ring-white/50" placeholder="4003">
                    <button id="saveLanTarget" type="button" class="w-full rounded-2xl bg-white/20 px-4 py-3 text-sm font-semibold text-white transition hover:bg-white/30 focus:outline-none focus:ring-2 focus:ring-white/40">Save target</button>
                </div>

                <div class="space-y-3">
                    <div class="grid grid-cols-2 gap-2">
                        <button id="lanOn" type="button" class="rounded-2xl bg-emerald-500/30 px-4 py-2 text-sm font-semibold text-emerald-50 transition hover:bg-emerald-500/40">On</button>
                        <button id="lanOff" type="button" class="rounded-2xl bg-rose-500/30 px-4 py-2 text-sm font-semibold text-rose-50 transition hover:bg-rose-500/40">Off</button>
                        <button id="lanToggle" type="button" class="rounded-2xl bg-white/15 px-4 py-2 text-sm font-semibold text-white transition hover:bg-white/25">Toggle</button>
                        <button id="lanStatusBtn" type="button" class="rounded-2xl bg-white/15 px-4 py-2 text-sm font-semibold text-white transition hover:bg-white/25">Get status</button>
                    </div>

                    <div class="space-y-2 rounded-2xl border border-white/10 bg-white/5 p-3">
                        <label class="text-xs font-semibold uppercase tracking-wide text-indigo-200">Brightness</label>
                        <input id="lanBrightness" type="range" min="1" max="100" class="w-full" value="50">
                        <div class="flex items-center justify-between text-sm text-slate-200">
                            <span>Level: <span id="lanBrightnessValue">50%</span></span>
                            <button id="lanApplyBrightness" type="button" class="rounded-xl bg-white/15 px-3 py-1 text-xs font-semibold text-white transition hover:bg-white/25">Apply</button>
                        </div>
                    </div>

                    <div class="space-y-2 rounded-2xl border border-white/10 bg-white/5 p-3">
                        <label class="text-xs font-semibold uppercase tracking-wide text-indigo-200">Color</label>
                        <div class="flex items-center gap-3">
                            <input id="lanColor" type="color" class="h-12 w-16 rounded-lg border border-white/20 bg-white/5" value="#ffcc88">
                            <button id="lanApplyColor" type="button" class="rounded-xl bg-white/15 px-3 py-2 text-sm font-semibold text-white transition hover:bg-white/25">Send color</button>
                        </div>
                        <div class="flex flex-wrap gap-2">
                            <button data-preset="warm" class="preset-btn rounded-xl bg-white/10 px-3 py-1 text-xs font-semibold text-white transition hover:bg-white/20" type="button">Warm</button>
                            <button data-preset="blue" class="preset-btn rounded-xl bg-white/10 px-3 py-1 text-xs font-semibold text-white transition hover:bg-white/20" type="button">Ocean</button>
                            <button data-preset="sunset" class="preset-btn rounded-xl bg-white/10 px-3 py-1 text-xs font-semibold text-white transition hover:bg-white/20" type="button">Sunset</button>
                            <button data-preset="white" class="preset-btn rounded-xl bg-white/10 px-3 py-1 text-xs font-semibold text-white transition hover:bg-white/20" type="button">White</button>
                        </div>
                    </div>
                </div>

                <div class="space-y-3 rounded-2xl border border-white/10 bg-white/5 p-4">
                    <div class="text-xs font-semibold uppercase tracking-wide text-indigo-200">Last status</div>
                    <div class="grid gap-2 text-sm">
                        <div class="rounded-xl bg-slate-900/40 px-3 py-2">Online: <span id="lanOnline" class="font-mono text-white">—</span></div>
                        <div class="rounded-xl bg-slate-900/40 px-3 py-2">Power: <span id="lanPower" class="font-mono text-white">—</span></div>
                        <div class="rounded-xl bg-slate-900/40 px-3 py-2">Brightness: <span id="lanBrightnessLabel" class="font-mono text-white">—</span></div>
                        <div class="rounded-xl bg-slate-900/40 px-3 py-2 flex items-center gap-2">Color:
                            <span id="lanColorSwatch" class="h-5 w-5 rounded border border-white/30 bg-white/20"></span>
                            <span id="lanColorLabel" class="font-mono text-white">—</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="space-y-4 rounded-3xl bg-white/5 p-6 shadow-2xl backdrop-blur-md md:p-8">
            <div class="flex flex-col gap-2 md:flex-row md:items-center md:justify-between">
                <div>
                    <h2 class="text-xl font-bold text-white">LAN Discovery</h2>
                    <p class="text-sm text-slate-300">Listen on UDP 4002 and send the multicast probe to 239.255.255.250:4001.</p>
                </div>
                <button id="discoverLan" type="button" class="rounded-2xl bg-white/15 px-4 py-2 text-sm font-semibold text-white transition hover:bg-white/25">Discover lights</button>
            </div>
            <div id="discoveryResults" class="space-y-2 rounded-2xl border border-white/10 bg-white/5 p-4 text-sm text-slate-200">
                <p>No devices discovered yet.</p>
            </div>
        </section>

        <section class="space-y-4 rounded-3xl bg-white/5 p-6 shadow-2xl backdrop-blur-md md:p-8">
            <div class="flex flex-col gap-2 md:flex-row md:items-center md:justify-between">
                <div>
                    <h2 class="text-xl font-bold text-white">Govee Cloud</h2>
                    <p class="text-sm text-slate-300">Requires the official Govee developer API key. All calls proxy through the Tauri backend.</p>
                </div>
                <div id="cloudStatus" class="text-sm text-indigo-100"></div>
            </div>

            <div class="grid gap-4 md:grid-cols-3">
                <div class="space-y-3">
                    <label class="text-xs font-semibold uppercase tracking-wide text-indigo-200">API Key</label>
                    <input id="cloudApiKey" type="password" class="w-full rounded-2xl border border-white/20 bg-white/10 px-4 py-3 text-white placeholder:text-slate-400 focus:border-white/50 focus:outline-none focus:ring-2 focus:ring-white/50" placeholder="Paste your Govee API key">
                    <div class="flex flex-wrap gap-2">
                        <button id="saveApiKey" type="button" class="rounded-2xl bg-white/15 px-4 py-2 text-sm font-semibold text-white transition hover:bg-white/25">Save key</button>
                        <button id="clearApiKey" type="button" class="hidden rounded-2xl bg-rose-500/30 px-4 py-2 text-sm font-semibold text-rose-50 transition hover:bg-rose-500/40">Clear</button>
                        <button id="loadCloudDevices" type="button" class="rounded-2xl bg-white/15 px-4 py-2 text-sm font-semibold text-white transition hover:bg-white/25">Load devices</button>
                    </div>
                    <p id="cloudKeyStatus" class="text-xs text-slate-300">No API key saved.</p>
                </div>

                <div class="space-y-3">
                    <label class="text-xs font-semibold uppercase tracking-wide text-indigo-200">Devices</label>
                    <select id="cloudDeviceSelect" class="w-full rounded-2xl border border-white/20 bg-white/10 px-4 py-3 text-sm text-white focus:border-white/50 focus:outline-none focus:ring-2 focus:ring-white/50">
                        <option value="">Select a device…</option>
                    </select>
                    <p class="text-xs text-slate-300">You can also enter a device id + model manually.</p>
                    <input id="cloudDeviceId" type="text" class="w-full rounded-2xl border border-white/20 bg-white/10 px-4 py-3 text-white placeholder:text-slate-400 focus:border-white/50 focus:outline-none focus:ring-2 focus:ring-white/50" placeholder="device id">
                    <input id="cloudModel" type="text" class="w-full rounded-2xl border border-white/20 bg-white/10 px-4 py-3 text-white placeholder:text-slate-400 focus:border-white/50 focus:outline-none focus:ring-2 focus:ring-white/50" placeholder="model (sku)">
                </div>

                <div class="space-y-3 rounded-2xl border border-white/10 bg-white/5 p-4">
                    <div class="grid grid-cols-2 gap-2">
                        <button id="cloudOn" type="button" class="rounded-2xl bg-emerald-500/30 px-4 py-2 text-sm font-semibold text-emerald-50 transition hover:bg-emerald-500/40">On</button>
                        <button id="cloudOff" type="button" class="rounded-2xl bg-rose-500/30 px-4 py-2 text-sm font-semibold text-rose-50 transition hover:bg-rose-500/40">Off</button>
                        <button id="cloudToggle" type="button" class="rounded-2xl bg-white/15 px-4 py-2 text-sm font-semibold text-white transition hover:bg-white/25">Toggle</button>
                        <button id="cloudState" type="button" class="rounded-2xl bg-white/15 px-4 py-2 text-sm font-semibold text-white transition hover:bg-white/25">Get state</button>
                    </div>
                    <div class="space-y-2">
                        <label class="text-xs font-semibold uppercase tracking-wide text-indigo-200">Brightness</label>
                        <input id="cloudBrightness" type="range" min="1" max="100" class="w-full" value="50">
                        <div class="flex items-center justify-between text-sm text-slate-200">
                            <span>Level: <span id="cloudBrightnessValue">50%</span></span>
                            <button id="cloudApplyBrightness" type="button" class="rounded-xl bg-white/15 px-3 py-1 text-xs font-semibold text-white transition hover:bg-white/25">Apply</button>
                        </div>
                    </div>
                    <div class="space-y-2">
                        <label class="text-xs font-semibold uppercase tracking-wide text-indigo-200">Color</label>
                        <div class="flex items-center gap-3">
                            <input id="cloudColor" type="color" class="h-12 w-16 rounded-lg border border-white/20 bg-white/5" value="#ffcc88">
                            <button id="cloudApplyColor" type="button" class="rounded-xl bg-white/15 px-3 py-2 text-sm font-semibold text-white transition hover:bg-white/25">Send color</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="rounded-2xl border border-white/10 bg-slate-900/50 p-4 text-sm text-white">
                <div class="text-xs font-semibold uppercase tracking-wide text-indigo-200">Cloud state</div>
                <pre id="cloudStateOutput" class="mt-2 whitespace-pre-wrap text-slate-100">No cloud state loaded.</pre>
            </div>
        </section>

        <section class="space-y-3 rounded-3xl bg-white/5 p-6 shadow-2xl backdrop-blur-md md:p-8">
            <div class="flex items-center justify-between">
                <h2 class="text-xl font-bold text-white">Activity</h2>
                <button id="clearActivity" type="button" class="text-sm font-semibold text-white underline decoration-white/40 underline-offset-4 hover:decoration-white">Clear log</button>
            </div>
            <ul id="activityLog" class="space-y-2 text-sm text-slate-200">
                <li class="text-slate-400">No activity yet.</li>
            </ul>
        </section>
    </div>

    <script src="js/tauri-bridge.js"></script>
    <script src="lights.js"></script>
</body>
</html>
