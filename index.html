<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Toddler Lights</title>
    <link rel="stylesheet" href="tailwind.css">
    <style>
        body {
            -webkit-tap-highlight-color: transparent;
        }

        button {
            touch-action: manipulation;
        }

        .min-h-screen {
            min-height: 100vh;
            min-height: 100svh;
        }

        @supports (min-height: 100dvh) {
            .min-h-screen {
                min-height: 100dvh;
            }
        }

        body.fireworks-open,
        body.timer-open,
        body.youtube-player-open {
            overflow: hidden;
        }

        .showcase-highlight {
            outline: 4px solid rgba(255, 255, 255, 0.7);
            outline-offset: 4px;
            transition: outline-offset 0.2s ease, outline-color 0.2s ease;
        }

        .timer-overlay {
            backdrop-filter: blur(16px);
            background: rgba(15, 23, 42, 0.72);
        }

        .fireworks-overlay {
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(8px);
            background: rgba(15, 23, 42, 0.8);
            padding: clamp(1.5rem, 4vw, 3rem);
        }

        .fireworks-stage {
            position: absolute;
            inset: 0;
            overflow: hidden;
            pointer-events: none;
            background: radial-gradient(circle at 50% 50%, rgba(255, 255, 255, 0.12), rgba(15, 23, 42, 0.65));
        }

        .fireworks-content {
            position: relative;
            z-index: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 1.5rem;
            width: 100%;
            max-width: 640px;
            margin: auto;
            padding: 2.5rem 1.5rem 3rem;
            text-align: center;
        }

        .firework-particle {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0.75rem;
            height: 0.75rem;
            border-radius: 9999px;
            opacity: 0;
            transform: translate(-50%, -50%) scale(0.5);
            animation: fireworkTravel 1000ms ease-out forwards;
        }

        @keyframes fireworkTravel {
            0% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(0.5);
            }

            80% {
                opacity: 1;
            }

            100% {
                opacity: 0;
                transform: translate(calc(var(--x) - 50%), calc(var(--y) - 50%)) scale(0.1);
            }
        }

        .tab-hidden {
            display: none !important;
        }

        #bottomTabNav {
            box-shadow: 0 -12px 32px rgba(15, 23, 42, 0.35);
            bottom: 0;
            padding-bottom: env(safe-area-inset-bottom, 0px);
        }

        #bottomTabNav button[data-tab-active="true"] {
            background: rgba(255, 255, 255, 0.18);
            color: #fff;
        }

        @keyframes spin {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        @keyframes pulse-grow {

            0%,
            100% {
                transform: scale(1);
                opacity: 1;
            }

            50% {
                transform: scale(1.2);
                opacity: 0.8;
            }
        }

        @keyframes bounce-float {

            0%,
            100% {
                transform: translateY(0px);
            }

            50% {
                transform: translateY(-20px);
            }
        }

        @keyframes rotate-pulse {

            0%,
            100% {
                transform: rotate(0deg) scale(1);
            }

            25% {
                transform: rotate(90deg) scale(1.1);
            }

            50% {
                transform: rotate(180deg) scale(1);
            }

            75% {
                transform: rotate(270deg) scale(1.1);
            }
        }

        @keyframes wiggle {

            0%,
            100% {
                transform: rotate(0deg);
            }

            25% {
                transform: rotate(-15deg);
            }

            75% {
                transform: rotate(15deg);
            }
        }

        @keyframes rainbow-glow {
            0% {
                filter: drop-shadow(0 0 20px rgba(255, 0, 0, 0.6));
            }

            33% {
                filter: drop-shadow(0 0 20px rgba(0, 255, 0, 0.6));
            }

            66% {
                filter: drop-shadow(0 0 20px rgba(0, 0, 255, 0.6));
            }

            100% {
                filter: drop-shadow(0 0 20px rgba(255, 0, 0, 0.6));
            }
        }

        .timer-emoji-btn[data-selected="true"] {
            background: rgba(255, 255, 255, 0.35);
            box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.6);
        }

        .youtube-mode-btn[data-selected="true"] {
            background: rgba(255, 255, 255, 0.25);
            box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.5);
        }

        /* Hide scrollbars for carousel sections */
        #kidQuickSection .overflow-x-auto::-webkit-scrollbar {
            display: none;
        }

        /* Snap scrolling for carousel items */
        #toddlerQuickColumn>button {
            scroll-snap-align: start;
        }
    </style>
</head>

<body class="min-h-screen bg-gradient-to-br from-indigo-500 via-indigo-600 to-purple-700 text-white">
    <!-- Settings Lock Button -->
    <button id="settingsLock"
        class="fixed left-5 top-5 z-30 flex h-16 w-16 items-center justify-center rounded-full bg-white/10 text-2xl shadow-lg backdrop-blur transition hover:bg-white/20 focus:outline-none focus:ring-2 focus:ring-white/60 select-none"
        style="user-select: none; -webkit-user-select: none; -moz-user-select: none;" onmousedown="startSettingsHold()"
        onmouseup="stopSettingsHold()" onmouseleave="stopSettingsHold()" ontouchstart="startSettingsHold()"
        ontouchend="stopSettingsHold()" onclick="handleSettingsClick(event)">
        <svg class="absolute inset-0 h-full w-full -rotate-90 pointer-events-none" aria-hidden="true">
            <circle id="progressCircle" cx="32" cy="32" r="26" stroke="#c4b5fd" stroke-width="4" stroke-dasharray="163"
                stroke-dashoffset="163" fill="none"></circle>
        </svg>
        <span class="relative pointer-events-none">‚öôÔ∏è</span>
    </button>

    <button
        class="fixed right-5 top-5 z-50 flex h-12 w-12 items-center justify-center rounded-full bg-white/10 text-xl shadow-lg backdrop-blur transition hover:bg-white/20 focus:outline-none focus:ring-2 focus:ring-white/60"
        onclick="toggleTheme()" aria-label="Toggle theme">
        üåì
    </button>

    <!-- PIN Modal -->
    <div id="pinModal" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/70 backdrop-blur">
        <div class="w-[90%] max-w-xs rounded-3xl bg-white p-6 text-center text-slate-900 shadow-2xl">
            <h2 class="text-xl font-semibold text-indigo-600">Enter Grown-up PIN</h2>
            <p class="mt-1 text-sm text-slate-500">Hold the gear button, then type the code.</p>
            <div id="pinDisplay"
                class="mx-auto mt-4 flex h-12 w-full max-w-[220px] items-center justify-center gap-3 rounded-full bg-indigo-50 text-2xl font-semibold tracking-[0.65em] text-indigo-600">
                ‚Ä¢‚Ä¢‚Ä¢‚Ä¢</div>
            <div class="mt-6 grid grid-cols-3 gap-3">
                <button
                    class="rounded-2xl bg-indigo-100 py-4 text-xl font-bold text-indigo-700 shadow-inner transition hover:bg-indigo-200 active:scale-95"
                    onclick="enterPin('1')">1</button>
                <button
                    class="rounded-2xl bg-indigo-100 py-4 text-xl font-bold text-indigo-700 shadow-inner transition hover:bg-indigo-200 active:scale-95"
                    onclick="enterPin('2')">2</button>
                <button
                    class="rounded-2xl bg-indigo-100 py-4 text-xl font-bold text-indigo-700 shadow-inner transition hover:bg-indigo-200 active:scale-95"
                    onclick="enterPin('3')">3</button>
                <button
                    class="rounded-2xl bg-indigo-100 py-4 text-xl font-bold text-indigo-700 shadow-inner transition hover:bg-indigo-200 active:scale-95"
                    onclick="enterPin('4')">4</button>
                <button
                    class="rounded-2xl bg-indigo-100 py-4 text-xl font-bold text-indigo-700 shadow-inner transition hover:bg-indigo-200 active:scale-95"
                    onclick="enterPin('5')">5</button>
                <button
                    class="rounded-2xl bg-indigo-100 py-4 text-xl font-bold text-indigo-700 shadow-inner transition hover:bg-indigo-200 active:scale-95"
                    onclick="enterPin('6')">6</button>
                <button
                    class="rounded-2xl bg-indigo-100 py-4 text-xl font-bold text-indigo-700 shadow-inner transition hover:bg-indigo-200 active:scale-95"
                    onclick="enterPin('7')">7</button>
                <button
                    class="rounded-2xl bg-indigo-100 py-4 text-xl font-bold text-indigo-700 shadow-inner transition hover:bg-indigo-200 active:scale-95"
                    onclick="enterPin('8')">8</button>
                <button
                    class="rounded-2xl bg-indigo-100 py-4 text-xl font-bold text-indigo-700 shadow-inner transition hover:bg-indigo-200 active:scale-95"
                    onclick="enterPin('9')">9</button>
                <button
                    class="col-span-3 rounded-2xl bg-indigo-200 py-3 text-sm font-semibold uppercase tracking-wide text-indigo-700 transition hover:bg-indigo-300 active:scale-95"
                    onclick="clearPin()">Clear</button>
                <button
                    class="rounded-2xl bg-indigo-100 py-4 text-xl font-bold text-indigo-700 shadow-inner transition hover:bg-indigo-200 active:scale-95"
                    onclick="enterPin('0')">0</button>
                <button
                    class="rounded-2xl bg-slate-200 py-4 text-base font-semibold text-slate-700 shadow-inner transition hover:bg-slate-300 active:scale-95"
                    onclick="closePinModal()">Cancel</button>
            </div>
        </div>
    </div>

    <main class="mx-auto flex min-h-screen w-full flex-col gap-6 px-4 pb-32 pt-20 sm:gap-8 md:px-8 md:pt-24 lg:px-12">
        <div id="statusMessage" class="status-message hidden"></div>
        <div id="advancedSettingsBanner" data-settings
            class="hidden flex flex-wrap items-center justify-between gap-3 rounded-3xl bg-white/15 px-5 py-4 text-sm font-semibold text-white shadow-2xl backdrop-blur md:px-6">
            <span>Advanced controls are unlocked. Make your changes, then tuck them away when you‚Äôre done.</span>
            <button
                class="rounded-2xl bg-white/20 px-4 py-2 text-xs font-semibold uppercase tracking-wide text-white shadow-md transition hover:bg-white/30 focus:outline-none focus:ring-2 focus:ring-white/50"
                onclick="sendKey('VolumeMute')">üîá Mute</button>

            <button
                class="remote-btn rounded-2xl bg-white/10 px-4 py-4 sm:px-5 sm:py-5 text-white shadow-inner transition hover:bg-white/20 focus:outline-none focus:ring-2 focus:ring-white/40 active:scale-95 touch-manipulation"
                onclick="sendKey('PowerOff')">üîò Power</button>
            <button
                class="remote-btn rounded-2xl bg-white/10 px-4 py-4 sm:px-5 sm:py-5 text-white shadow-inner transition hover:bg-white/20 focus:outline-none focus:ring-2 focus:ring-white/40 active:scale-95 touch-manipulation"
                onclick="sendKey('VolumeDown')">üîâ Vol-</button>
            <button
                class="remote-btn rounded-2xl bg-white/10 px-4 py-4 sm:px-5 sm:py-5 text-white shadow-inner transition hover:bg-white/20 focus:outline-none focus:ring-2 focus:ring-white/40 active:scale-95 touch-manipulation"
                onclick="sendKey('ChannelUp')">‚¨ÜÔ∏è CH+</button>
        </div>
        </section>

        <section id="macroSection" class="hidden rounded-3xl bg-white/15 p-6 shadow-2xl backdrop-blur md:p-8"
            data-settings>
            <div class="flex flex-wrap items-center justify-between gap-4">
                <div>
                    <h2 class="text-2xl font-bold text-white">Macro Magic</h2>
                    <p class="mt-1 text-sm text-indigo-100">Create sequences to launch apps, wait, and press buttons
                        automatically.</p>
                </div>
                <button onclick="openMacroHelp()"
                    class="rounded-full bg-white/10 px-4 py-2 text-sm font-semibold text-white transition hover:bg-white/20">How
                    it works</button>
            </div>

            <div class="mt-6 grid gap-6 lg:grid-cols-[2fr,3fr]">
                <form id="macroForm" class="grid gap-4 rounded-3xl bg-slate-950/40 p-5">
                    <label class="grid gap-2 text-sm font-semibold uppercase tracking-wide text-indigo-200">
                        Macro Name
                        <input id="macroName" type="text"
                            class="rounded-2xl border border-white/10 bg-white/10 px-4 py-3 text-white placeholder:text-indigo-100/50 focus:border-white/40 focus:outline-none focus:ring-2 focus:ring-white/30"
                            placeholder="Bedtime Routine" required />
                    </label>

                    <label class="grid gap-2 text-sm font-semibold uppercase tracking-wide text-indigo-200">
                        Steps
                        <div
                            class="rounded-2xl border border-dashed border-white/20 bg-white/5 px-4 py-4 text-sm text-indigo-100">
                            <p class="text-xs uppercase tracking-wide text-indigo-200/80">Add step</p>
                            <div class="mt-3 flex flex-col gap-3 sm:flex-row">
                                <select id="macroActionType"
                                    class="flex-1 rounded-2xl border border-white/10 bg-white/10 px-4 py-3 text-white focus:border-white/40 focus:outline-none focus:ring-2 focus:ring-white/30">
                                    <option value="key">Press Remote Key</option>
                                    <option value="launch">Launch App</option>
                                    <option value="delay">Wait</option>
                                </select>
                                <input id="macroActionValue" type="text"
                                    class="flex-1 rounded-2xl border border-white/10 bg-white/10 px-4 py-3 text-white placeholder:text-indigo-100/50 focus:border-white/40 focus:outline-none focus:ring-2 focus:ring-white/30"
                                    placeholder="Key (Home) / App ID (12) / Milliseconds (1000)" />
                                <button type="button" onclick="addMacroStep()"
                                    class="rounded-2xl bg-white px-5 py-3 text-base font-semibold text-indigo-600 shadow-lg transition hover:bg-indigo-50">Add
                                    Step</button>
                            </div>
                        </div>
                    </label>

                    <ul id="macroStepsPreview"
                        class="min-h-[80px] space-y-3 rounded-2xl bg-indigo-950/30 p-4 text-sm text-indigo-100"></ul>

                    <div class="flex flex-col gap-3 sm:flex-row sm:justify-between">
                        <label class="flex items-center gap-2 text-sm text-indigo-100">
                            <input id="macroMarkFavorite" type="checkbox"
                                class="h-4 w-4 rounded border-white/40 bg-white/10 text-indigo-500 focus:ring-white/40" />
                            Show in kid mode as the Magic Button
                        </label>
                        <button type="submit"
                            class="rounded-2xl bg-primary px-6 py-3 text-base font-bold text-white shadow-lg transition hover:bg-primary-dark">Save
                            Macro</button>
                    </div>
                </form>

                <div class="space-y-4">
                    <h3 class="text-lg font-semibold text-white">Saved Macros</h3>
                    <div id="macroList" class="grid gap-3"></div>
                </div>
            </div>
        </section>
    </main>

    <!-- Bottom Navigation with integrated Room Selector -->
    <nav id="bottomTabNav" class="fixed inset-x-0 bottom-0 z-40 hidden bg-slate-950/80 text-white backdrop-blur-lg">
        <!-- Room Selector Section (shown when rooms are configured) -->
        <div id="roomSelectorBar"
            class="hidden bg-gradient-to-r from-purple-900/90 to-indigo-900/90 border-t border-white/20">
            <div class="mx-auto flex w-full max-w-4xl items-center justify-between gap-2 px-3 py-2">
                <div class="flex items-center gap-2 flex-1 min-w-0">
                    <span id="currentRoomIndicator" class="text-xs font-semibold truncate">üìç All Rooms</span>
                </div>
                <div class="flex items-center gap-2">
                    <!-- Room Selector Dropdown -->
                    <select id="roomSelector" onchange="setCurrentRoom(this.value, 'manual')"
                        class="rounded-lg border border-white/40 bg-white/20 px-2 py-1 text-xs font-semibold text-white focus:border-white/60 focus:bg-white/30 focus:outline-none focus:ring-2 focus:ring-white/50"
                        style="color: white; background-color: rgba(255, 255, 255, 0.2);">
                        <option value="" style="background-color: #1e1b4b; color: white;">All Rooms</option>
                    </select>

                    <!-- Auto-detect Toggle Button -->
                    <button id="roomAutoDetectToggle" onclick="toggleRoomAutoDetect()"
                        class="flex items-center justify-center gap-1 px-2 h-7 rounded-lg border border-white/30 bg-white/10 hover:bg-white/20 active:bg-white/30 transition-colors whitespace-nowrap"
                        title="Toggle auto room detection">
                        <span id="roomAutoDetectIcon" class="text-sm">üîç</span>
                        <span class="text-xs font-semibold">Auto</span>
                    </button>

                    <!-- Locate Button -->
                    <button id="roomLocateButton" onclick="manuallyLocateRoom()"
                        class="flex items-center justify-center w-7 h-7 rounded-lg border border-white/30 bg-white/10 hover:bg-white/20 active:bg-white/30 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                        title="Find current room">
                        <span class="text-sm">üì°</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Tab Buttons Section -->
        <div id="bottomTabButtons" class="mx-auto flex w-full max-w-4xl items-stretch justify-around gap-2 px-4 py-3">
        </div>
    </nav>

    <div id="toastContainer" class="pointer-events-none fixed left-1/2 top-6 z-50 hidden -translate-x-1/2 transform">
    </div>

    <div id="timerOverlay"
        class="timer-overlay fixed inset-0 z-50 hidden items-center justify-center px-6 py-12 text-white">
        <div class="w-full max-w-md rounded-3xl bg-white/10 p-8 shadow-2xl">
            <div class="text-center mb-6">
                <div id="timerOriginalTime" class="text-lg font-semibold text-indigo-200">5:00</div>
            </div>

            <div class="relative mx-auto flex h-64 w-64 items-center justify-center">
                <div id="timerSpinnerEmoji" class="absolute text-9xl" style="animation: spin 3s linear infinite;">‚≠ê
                </div>
                <div class="relative flex flex-col items-center justify-center text-center z-10">
                    <span id="timerCountdown"
                        class="text-5xl font-extrabold tracking-tight text-white drop-shadow-lg">00:00</span>
                </div>
            </div>

            <div class="mt-6 flex flex-wrap justify-center gap-2">
                <button type="button" data-timer-emoji="‚≠ê"
                    class="timer-emoji-btn rounded-xl bg-white/15 px-3 py-2 text-3xl transition hover:bg-white/25 hover:scale-110 focus:outline-none focus:ring-2 focus:ring-white/40 active:scale-95">‚≠ê</button>
                <button type="button" data-timer-emoji="üé®"
                    class="timer-emoji-btn rounded-xl bg-white/15 px-3 py-2 text-3xl transition hover:bg-white/25 hover:scale-110 focus:outline-none focus:ring-2 focus:ring-white/40 active:scale-95">üé®</button>
                <button type="button" data-timer-emoji="ü¶Ñ"
                    class="timer-emoji-btn rounded-xl bg-white/15 px-3 py-2 text-3xl transition hover:bg-white/25 hover:scale-110 focus:outline-none focus:ring-2 focus:ring-white/40 active:scale-95">ü¶Ñ</button>
                <button type="button" data-timer-emoji="üöÄ"
                    class="timer-emoji-btn rounded-xl bg-white/15 px-3 py-2 text-3xl transition hover:bg-white/25 hover:scale-110 focus:outline-none focus:ring-2 focus:ring-white/40 active:scale-95">üöÄ</button>
                <button type="button" data-timer-emoji="üåà"
                    class="timer-emoji-btn rounded-xl bg-white/15 px-3 py-2 text-3xl transition hover:bg-white/25 hover:scale-110 focus:outline-none focus:ring-2 focus:ring-white/40 active:scale-95">üåà</button>
                <button type="button" data-timer-emoji="üéà"
                    class="timer-emoji-btn rounded-xl bg-white/15 px-3 py-2 text-3xl transition hover:bg-white/25 hover:scale-110 focus:outline-none focus:ring-2 focus:ring-white/40 active:scale-95">üéà</button>
                <button type="button" data-timer-emoji="üçé"
                    class="timer-emoji-btn rounded-xl bg-white/15 px-3 py-2 text-3xl transition hover:bg-white/25 hover:scale-110 focus:outline-none focus:ring-2 focus:ring-white/40 active:scale-95">üçé</button>
                <button type="button" data-timer-emoji="‚ö°"
                    class="timer-emoji-btn rounded-xl bg-white/15 px-3 py-2 text-3xl transition hover:bg-white/25 hover:scale-110 focus:outline-none focus:ring-2 focus:ring-white/40 active:scale-95">‚ö°</button>
            </div>

            <button id="timerOverlayDismiss" onclick="cancelToddlerTimer()"
                class="mt-6 w-full rounded-2xl bg-rose-500/80 px-5 py-4 text-base font-bold text-white shadow-lg transition hover:bg-rose-600 focus:outline-none focus:ring-2 focus:ring-white/60">
                Stop Timer
            </button>
        </div>
    </div>

    <div id="fireworksOverlay" class="fireworks-overlay fixed inset-0 z-40 hidden text-white">
        <div id="fireworksStage" class="fireworks-stage"></div>
        <div class="fireworks-content">
            <div class="space-y-3">
                <h2 class="text-4xl font-extrabold tracking-tight drop-shadow-lg">üéÜ Fireworks Celebration</h2>
                <p id="fireworksLabel" class="text-base font-semibold text-indigo-100 drop-shadow-md">Celebration time.
                </p>
            </div>
            <button onclick="stopFireworksShow()"
                class="rounded-full bg-white/20 px-6 py-3 text-xs font-semibold uppercase tracking-[0.35em] text-white shadow-lg transition hover:bg-white/30 focus:outline-none focus:ring-2 focus:ring-white/50">
                End Fireworks
            </button>
        </div>
    </div>

    <div id="youtubePlayerOverlay" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/95 px-4 py-6">
        <div class="relative w-full max-w-6xl">
            <button onclick="closeYoutubePlayer()"
                class="absolute -top-12 right-0 rounded-full bg-white/10 px-4 py-2 text-sm font-semibold uppercase tracking-wide text-white transition hover:bg-white/20 focus:outline-none focus:ring-2 focus:ring-white/40">
                Close Video
            </button>
            <div class="relative w-full pt-[56.25%]">
                <iframe id="youtubePlayerFrame" class="absolute inset-0 h-full w-full rounded-2xl" src=""
                    frameborder="0"
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                    allowfullscreen>
                </iframe>
            </div>
        </div>
    </div>

    <script src="modules.js"></script>
    <script src="vendor/confetti.js"></script>
    <script src="app.js"></script>
</body>

</html>